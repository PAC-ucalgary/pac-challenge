<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PAC Volunteer Challenge – Live Leaderboard</title>
  <meta name="description" content="Live house rankings and challenge info for the PAC Volunteer Challenge." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0f14;
      --panel: rgba(17,24,35,.65);
      --text:#e8eef5; --muted:#a7b3c2;
      --brand:#4cc9f0; --brand2:#a3f7bf;
      --shadow:0 10px 30px rgba(0,0,0,.35), 0 1px 0 rgba(255,255,255,.03) inset;
      --gold:#f5d770; --silver:#cfd7e6; --bronze:#e7b28a;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1200px 600px at 80% -10%, rgba(76,201,240,.15), transparent 60%),
        radial-gradient(800px 400px at -10% 10%, rgba(163,247,191,.12), transparent 60%),
        var(--bg);
      color:var(--text);
    }
    header{
      position:sticky; top:0; z-index:10; backdrop-filter:saturate(150%) blur(8px);
      background:linear-gradient(180deg, rgba(11,15,20,.75), rgba(11,15,20,.45));
      border-bottom:1px solid rgba(255,255,255,.06);
      opacity:.001; transform:translateY(-10px);
    }
    @keyframes fadeSlideDown { from{opacity:0; transform:translateY(-10px)} to{opacity:1; transform:translateY(0)} }
    .header-animate{ animation:fadeSlideDown .7s ease-out forwards }
    .container{width:min(1100px,92%); margin-inline:auto}
    main{padding:32px 0 64px}
    .grid{display:grid; gap:20px}
    @media(min-width:900px){ .grid{grid-template-columns:1.1fr .9fr} }
    .card{
      background: var(--panel);
      border:1px solid rgba(255,255,255,.06);
      border-radius:22px;
      padding:20px;
      box-shadow:var(--shadow);
      backdrop-filter: saturate(140%) blur(6px);
    }
    table{width:100%; border-collapse:collapse; font-size:.95rem}
    th,td{padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.06)}
    th{color:#cfe3f7;text-align:left}
    tr:hover td{background:rgba(255,255,255,.03)}
    .house-pill{display:inline-flex; align-items:center; padding:.3rem .6rem; border-radius:999px; background:rgba(76,201,240,.12); border:1px solid rgba(76,201,240,.3)}
    .row{display:flex; gap:12px; flex-wrap:wrap}
    .stat{flex:1 1 140px; background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:14px}

    .medal-1 td{ background:linear-gradient(180deg, rgba(245,215,112,.18), rgba(245,215,112,.08)); }
    .medal-2 td{ background:linear-gradient(180deg, rgba(207,215,230,.16), rgba(207,215,230,.06)); }
    .medal-3 td{ background:linear-gradient(180deg, rgba(231,178,138,.16), rgba(231,178,138,.06)); }

    footer{padding:24px 0 48px; color:#a7b3c2; text-align:center}
    #confettiCanvas{position:fixed; inset:0; width:100%; height:100%; pointer-events:none; z-index:999;}
  </style>
</head>
<body>
  <canvas id="confettiCanvas"></canvas>

  <header id="siteHeader">
    <div class="container nav" style="display:flex;align-items:center;justify-content:space-between;padding:.9rem 0;">
      <a class="brand" href="./" style="display:flex;align-items:center;gap:.55rem;font-weight:800;">
        <img src="PAC Logo.svg" style="width:55px;height:55px;object-fit:contain;border-radius:6px;">
        <span>PAC Challenge</span>
        <span style="display:inline-block;padding:.3rem .6rem;border-radius:999px;font-size:.75rem;background:linear-gradient(110deg,#a3f7bf,#7fe9d0);color:#06121a;">Live</span>
      </a>
      <div class="links" style="display:flex;gap:1rem;">
        <a id="docLink" target="_blank" rel="noopener" class="btn" style="background:linear-gradient(180deg,#4cc9f0,#2ea9ce);padding:.75rem 1rem;border-radius:14px;color:#041018;font-weight:700;">Challenge Doc</a>
        <a id="fullBtn" href="#full-leaderboard" class="btn" style="background:linear-gradient(180deg,#4cc9f0,#2ea9ce);padding:.75rem 1rem;border-radius:14px;color:#041018;font-weight:700;">View Full Leaderboard</a>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="grid">
      <div class="card">
        <h1>House Leaderboard</h1>
        <p class="small" style="color:#a7b3c2;">Live standings for the four houses.</p>
        <div class="row" id="houseStats"></div>
        <table id="houseTable" style="margin-top:12px">
          <thead><tr><th>Rank</th><th>House</th><th>Captain</th><th>Total Points</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="card">
        <h2>Top 5 Individuals</h2>
        <table id="top5Table">
          <thead><tr><th>Rank</th><th>Name</th><th>House</th><th>Points</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer>
    Built for PAC by your team • Refreshes automatically • Privacy-safe (read-only)
  </footer>

  <script>
    const CONFIG = {
      houseCSV:"https://docs.google.com/spreadsheets/d/e/2PACX-1vTGaBgr7vEI6G3w3900q0_Xr9JWRXm_3aLuP9ZXMTfmPNxU9pPJcptRft_XNLAFHip-QLzZlyEEIMNs/pub?gid=0&single=true&output=csv",
      individualCSV:"https://docs.google.com/spreadsheets/d/e/2PACX-1vTGaBgr7vEI6G3w3900q0_Xr9JWRXm_3aLuP9ZXMTfmPNxU9pPJcptRft_XNLAFHip-QLzZlyEEIMNs/pub?gid=200435731&single=true&output=csv"
    };
    const CAPTAINS={"Quds":"Mohammad Eldib","Gaza":"Ghassan Abuamsha","Qalqilya":"Nour Issa","Besan":"Besan Jadalowen"};
    let lastLeader=null;

    async function fetchCSV(url){const res=await fetch(url,{cache:'no-store'});if(!res.ok)throw new Error(res.status);return await res.text();}
    function parseCSV(t){return t.trim().split(/\r?\n/).map(r=>r.split(','));}
    function formatNumber(n){const x=Number(n);return isFinite(x)?x.toLocaleString():n;}

    function confettiBurst(){
      const canvas=document.getElementById('confettiCanvas');
      const ctx=canvas.getContext('2d');
      canvas.width=innerWidth;canvas.height=innerHeight;
      const parts=[];
      const colors=['#4cc9f0','#a3f7bf','#f5d770','#cfd7e6','#e7b28a'];
      for(let i=0;i<120;i++){
        parts.push({x:innerWidth/2+(Math.random()-0.5)*100,y:-20,vx:(Math.random()-0.5)*6,vy:2+Math.random()*3,g:0.2,w:6+Math.random()*6,h:10+Math.random()*8,r:Math.random()*Math.PI,spin:(Math.random()-0.5)*0.3,life:80,color:colors[Math.random()*colors.length|0]});
      }
      function tick(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        parts.forEach(p=>{p.vy+=p.g;p.x+=p.vx;p.y+=p.vy;p.r+=p.spin;p.life--;ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.r);ctx.fillStyle=p.color;ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);ctx.restore();});
        for(let i=parts.length-1;i>=0;i--)if(parts[i].life<=0||parts[i].y>innerHeight+40)parts.splice(i,1);
        if(parts.length>0)requestAnimationFrame(tick);
      }
      tick();
      setTimeout(()=>ctx.clearRect(0,0,canvas.width,canvas.height),2000);
    }

    function renderHouses(rows){
      const tbody=document.querySelector('#houseTable tbody');
      const stats=document.getElementById('houseStats');
      tbody.innerHTML='';stats.innerHTML='';
      const data=rows.slice(1).map(r=>({house:r[0],points:+r[1]||0})).sort((a,b)=>b.points-a.points);
      const leader=data[0]?.house;
      if(lastLeader&&leader!==lastLeader)confettiBurst();
      lastLeader=leader;
      data.forEach((r,i)=>{
        const tr=document.createElement('tr');
        if(i===0)tr.classList.add('medal-1');
        else if(i===1)tr.classList.add('medal-2');
        else if(i===2)tr.classList.add('medal-3');
        tr.innerHTML=`<td>${i+1}</td><td><span class="house-pill">${r.house}</span></td><td>${CAPTAINS[r.house]||"—"}</td><td>${formatNumber(r.points)}</td>`;
        tbody.appendChild(tr);
      });
      data.slice(0,3).forEach((r,i)=>{
        const d=document.createElement('div');
        d.className='stat';
        if(i===0)d.style.background='linear-gradient(180deg, rgba(245,215,112,.18), rgba(245,215,112,.08))';
        if(i===1)d.style.background='linear-gradient(180deg, rgba(207,215,230,.16), rgba(207,215,230,.06))';
        if(i===2)d.style.background='linear-gradient(180deg, rgba(231,178,138,.16), rgba(231,178,138,.06))';
        d.innerHTML=`<div style="color:#a7b3c2;font-size:.85rem;">#${i+1} House</div><div style="font-weight:800;font-size:1.1rem;">${r.house}</div><div style="color:#a7b3c2;font-size:.85rem;">${formatNumber(r.points)} pts • Captain:<br>${CAPTAINS[r.house]||"—"}</div>`;
        stats.appendChild(d);
      });
    }

    function renderTop5(rows){
      const tbody=document.querySelector('#top5Table tbody');
      tbody.innerHTML='';
      const data=rows.slice(1).map(r=>({name:r[0],house:r[1],points:+r[2]||0})).sort((a,b)=>b.points-a.points).slice(0,5);
      data.forEach((r,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${i+1}</td><td>${r.name}</td><td>${r.house}</td><td>${formatNumber(r.points)}</td>`;
        tbody.appendChild(tr);
      });
    }

    async function load(){
      const houseText=await fetchCSV(CONFIG.houseCSV);
      renderHouses(parseCSV(houseText));
      const indivText=await fetchCSV(CONFIG.individualCSV);
      renderTop5(parseCSV(indivText));
    }
    load(); setInterval(load,60000);

    window.addEventListener('DOMContentLoaded',()=>document.getElementById('siteHeader').classList.add('header-animate'));
  </script>
</body>
</html>
