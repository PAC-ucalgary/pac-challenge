<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PAC Volunteer Challenge – Live Leaderboard</title>
  <meta name="description" content="Live house rankings and challenge info for the PAC Volunteer Challenge." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0f14; --panel:#111823; --text:#e8eef5; --muted:#a7b3c2;
      --brand:#4cc9f0; --brand2:#a3f7bf; --ring:rgba(76,201,240,.35);
      --shadow:0 10px 30px rgba(0,0,0,.35), 0 1px 0 rgba(255,255,255,.03) inset;
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1200px 600px at 80% -10%, rgba(76,201,240,.15), transparent 60%),
        radial-gradient(800px 400px at -10% 10%, rgba(163,247,191,.12), transparent 60%),
        var(--bg);
      color:var(--text)
    }
    a{color:inherit; text-decoration:none}
    .container{width:min(1100px,92%); margin-inline:auto}
    header{position:sticky; top:0; z-index:10; backdrop-filter:saturate(150%) blur(8px);
      background:linear-gradient(180deg, rgba(11,15,20,.85), rgba(11,15,20,.55));
      border-bottom:1px solid rgba(255,255,255,.06)}
    .nav{display:flex; align-items:center; justify-content:space-between; padding:.9rem 0}

    /* Brand/logo */
    .brand{
      display:flex; align-items:center; gap:.55rem;
      font-weight:800; letter-spacing:.3px; color:inherit; text-decoration:none;
    }
    .brand-logo{
      width:32px; height:32px; object-fit:contain;
      border-radius:6px;
      filter: drop-shadow(0 1px 0 rgba(0,0,0,.2));
    }
    @media (min-width: 900px){
      .brand-logo{ width:34px; height:34px; }
    }

    .chip{display:inline-block; padding:.3rem .6rem; border-radius:999px; font-size:.75rem;
      color:#06121a; background:linear-gradient(110deg, var(--brand2), #7fe9d0)}
    .links{display:flex; gap:1rem}
    .btn{display:inline-flex; align-items:center; gap:.6rem; padding:.75rem 1rem; border-radius:14px;
      background:linear-gradient(180deg, var(--brand), #2ea9ce); color:#041018; font-weight:700;
      box-shadow:var(--shadow); border:1px solid rgba(255,255,255,.06)}
    .btn.secondary{background:transparent; color:var(--text); border:1px solid rgba(167,179,194,.25)}
    main{padding:32px 0 64px}
    .grid{display:grid; gap:20px}
    @media(min-width:900px){ .grid{grid-template-columns:1.1fr .9fr} }
    .card{background:var(--panel); border:1px solid rgba(255,255,255,.06); border-radius:22px; padding:20px; box-shadow:var(--shadow)}
    h1{font-size:clamp(28px,3vw,40px); margin:.2rem 0 1rem}
    h2{font-size:clamp(18px,2.2vw,24px); margin:.2rem 0 1rem}
    p{color:var(--muted)}
    table{width:100%; border-collapse:collapse; font-size:.95rem}
    th, td{padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.06); text-align:left}
    th{color:#cfe3f7}
    tr:hover td{background:rgba(255,255,255,.03)}
    .rank{font-weight:800}
    .house-pill{display:inline-flex; align-items:center; gap:.5rem; padding:.3rem .6rem; border-radius:999px;
      background:rgba(76,201,240,.12); border:1px solid rgba(76,201,240,.3)}
    .muted{color:var(--muted)} .small{font-size:.85rem}
    .row{display:flex; gap:12px; flex-wrap:wrap}
    .stat{flex:1 1 140px; background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.06);
      border-radius:16px; padding:14px}

    footer{padding:24px 0 48px; color:var(--muted); text-align:center}
    .error{color:#ffb4b4}
    code.inline{background:rgba(255,255,255,.08); padding:.2rem .35rem; border-radius:6px}

    /* Constant Challenge cards — refreshed look */
    .challenge-grid{
      display:grid; gap:16px; grid-template-columns:repeat(1,minmax(0,1fr));
    }
    @media(min-width:700px){ .challenge-grid{grid-template-columns:repeat(2,minmax(0,1fr));} }
    @media(min-width:1000px){ .challenge-grid{grid-template-columns:repeat(3,minmax(0,1fr));} }

    .challenge{
      position:relative;
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid rgba(76,201,240,.18);
      border-radius:18px; padding:18px 16px;
      display:flex; align-items:center; gap:14px;
      justify-content:space-between;
      transition:transform .15s ease, border-color .15s ease, background .15s ease;
    }
    .challenge:hover{ transform:translateY(-1px); border-color:rgba(76,201,240,.35);
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.025)); }
    .challenge .left{flex:1 1 auto; min-width:0}
    .title{font-weight:800; letter-spacing:.2px}
    .sub{font-size:.85rem; color:var(--muted); margin-top:4px}

    .pts{
      display:inline-flex; align-items:center; justify-content:center;
      height:38px; padding:0 .85rem; text-align:center;
      font-weight:900; border-radius:999px; white-space:nowrap;
      background:rgba(6,18,26,.6);
      border:1.5px solid rgba(76,201,240,.45);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
      flex:0 0 auto;
    }
    .pts.tight{ font-size:.9rem; height:36px; padding:0 .65rem; }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <!-- Brand with logo -->
      <a class="brand" href="./" aria-label="PAC Challenge home">
        <img class="brand-logo" src="PAC Logo.svg" alt="PAC logo" />
        <span>PAC Challenge</span>
        <span class="chip">Live</span>
      </a>

      <div class="links">
        <a class="btn" id="docLink" target="_blank" rel="noopener">Challenge Doc</a>
        <a class="btn" id="fullBtn" href="#full-leaderboard">View Full Leaderboard</a>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="grid">
      <!-- Left: House leaderboard -->
      <div class="card">
        <h1>House Leaderboard</h1>
        <p class="small muted">
          Live standings for the four houses. Keep completing challenges to push your team up the board.
        </p>
        <div class="row" id="houseStats"></div>
        <table id="houseTable" style="margin-top:12px">
          <thead>
            <tr><th>Rank</th><th>House</th><th>Captain</th><th>Total Points</th></tr>
          </thead>
          <tbody></tbody>
        </table>
        <div id="houseError" class="error small"></div>
      </div>

      <!-- Right: Top 5 Individuals -->
      <div class="card">
        <h2>Top 5 Individuals</h2>
        <p class="small muted">Live ranking of volunteers based on approved points.</p>
        <table id="top5Table">
          <thead>
            <tr><th>Rank</th><th>Name</th><th>House</th><th>Points</th></tr>
          </thead>
          <tbody></tbody>
        </table>
        <div id="indTopError" class="error small"></div>
      </div>
    </section>

    <!-- Constant challenges -->
    <section class="card" style="margin-top:20px">
      <h2>Constant Challenges (All Semester)</h2>
      <div class="challenge-grid">
        <div class="challenge"><div class="left"><div class="title">Wear pro-Palestinian attire</div><div class="sub">Keffiyeh, shirt, wristband…</div></div><div class="pts">5 / day</div></div>
        <div class="challenge"><div class="left"><div class="title">Whiteboard/blackboard messages</div><div class="sub">Use clear, factual language</div></div><div class="pts">10 each</div></div>
        <div class="challenge"><div class="left"><div class="title">Post-it note messages</div><div class="sub">Mirrors, cubicles, elevators…</div></div><div class="pts">2 each</div></div>
        <div class="challenge"><div class="left"><div class="title">Read an educational Palestine book</div><div class="sub">From the approved list</div></div><div class="pts tight">10 / 100 pages</div></div>
        <div class="challenge"><div class="left"><div class="title">Refer a friend to volunteer (GC)</div><div class="sub">Add them to the volunteer group chat</div></div><div class="pts">5 / person</div></div>
      </div>
    </section>

    <!-- Full Individual Leaderboard -->
    <section class="card" id="full-leaderboard" style="margin-top:20px">
      <h2>Individual Leaderboard (Full)</h2>
      <table id="indivTable">
        <thead>
          <tr><th>Rank</th><th>Name</th><th>House</th><th>Points</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <div id="indError" class="error small"></div>
    </section>
  </main>

  <footer>
    Built for PAC by your team • Refreshes automatically • Privacy-safe (read-only)
  </footer>

  <script>
    const CONFIG = {
      houseCSV: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTGaBgr7vEI6G3w3900q0_Xr9JWRXm_3aLuP9ZXMTfmPNxU9pPJcptRft_XNLAFHip-QLzZlyEEIMNs/pub?gid=0&single=true&output=csv",
      individualCSV: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTGaBgr7vEI6G3w3900q0_Xr9JWRXm_3aLuP9ZXMTfmPNxU9pPJcptRft_XNLAFHip-QLzZlyEEIMNs/pub?gid=200435731&single=true&output=csv",
      challengeDocURL: "https://docs.google.com/document/d/1j3UUIg44EYJbwhgLaZoyTG-nD0Af_nuqWdvY7mDyT7g/edit?usp=sharing"
    };

    const CAPTAINS = { "Quds":"Mohammad Eldib", "Gaza":"Ghassan Abuamsha", "Qalqilya":"Nour Issa", "Besan":"Besan Jadalowen" };

    document.getElementById('docLink').href = CONFIG.challengeDocURL || "#";
    document.getElementById('fullBtn').addEventListener('click', (e)=>{
      const el = document.querySelector('#full-leaderboard');
      if(el){ e.preventDefault(); el.scrollIntoView({behavior:'smooth', block:'start'}); }
    });

    async function fetchCSV(url){
      const res = await fetch(url, {cache:'no-store'});
      if(!res.ok) throw new Error(`HTTP ${res.status}`);
      return await res.text();
    }
    function parseCSV(t){ return t.trim().split(/\r?\n/).map(r => r.split(',')); }
    function formatNumber(n){ const x = Number(n); return isFinite(x) ? x.toLocaleString() : n; }

    function renderHouses(rows){
      const tbody = document.querySelector('#houseTable tbody');
      const stats = document.getElementById('houseStats');
      tbody.innerHTML = ''; stats.innerHTML = '';
      const data = rows.slice(1).map(r => ({house:r[0], points:+r[1]||0})).sort((a,b)=>b.points-a.points);

      data.forEach((r,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="rank">${i+1}</td>
          <td><span class="house-pill">${r.house}</span></td>
          <td>${CAPTAINS[r.house] || "—"}</td>
          <td>${formatNumber(r.points)}</td>`;
        tbody.appendChild(tr);
      });

      data.slice(0,3).forEach((r,i)=>{
        const d = document.createElement('div'); d.className='stat';
        d.innerHTML = `<div class="small muted">#${i+1} House</div>
                       <div style="font-weight:800; font-size:1.1rem">${r.house}</div>
                       <div class="small muted">${formatNumber(r.points)} pts • Captain: ${CAPTAINS[r.house] || "—"}</div>`;
        stats.appendChild(d);
      });
    }

    function renderTop5(rows){
      const tbody = document.querySelector('#top5Table tbody');
      tbody.innerHTML = '';
      if(!rows.length) return;
      const data = rows.slice(1).map(r=>({name:r[0],house:r[1],points:+r[2]||0}))
        .sort((a,b)=>b.points-a.points).slice(0,5);
      data.forEach((r,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="rank">${i+1}</td><td>${r.name}</td><td>${r.house}</td><td>${formatNumber(r.points)}</td>`;
        tbody.appendChild(tr);
      });
    }
    function renderIndividuals(rows){
      const tbody = document.querySelector('#indivTable tbody');
      tbody.innerHTML = '';
      if(!rows.length) return;
      const data = rows.slice(1).map(r=>({name:r[0],house:r[1],points:+r[2]||0}))
        .sort((a,b)=>b.points-a.points);
      data.forEach((r,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="rank">${i+1}</td><td>${r.name}</td><td>${r.house}</td><td>${formatNumber(r.points)}</td>`;
        tbody.appendChild(tr);
      });
    }

    async function load(){
      try{
        const houseText = await fetchCSV(CONFIG.houseCSV);
        renderHouses(parseCSV(houseText));

        const indivText = await fetchCSV(CONFIG.individualCSV);
        const rows = parseCSV(indivText);
        renderTop5(rows);
        renderIndividuals(rows);
      }catch(err){
        document.getElementById('houseError').textContent = 'House data error: ' + err.message;
        document.getElementById('indError').textContent = 'Individual data error: ' + err.message;
        document.getElementById('indTopError').textContent = 'Individual data error: ' + err.message;
      }
    }
    load();
    setInterval(load, 60000);
  </script>
</body>
</html>
